---
# This test covers the full feature set provided by the role

- name: "Create test resources"
  hosts: cdk

  vars_files:
    - vars/openshift_resources.json

  vars:
    openshift_password: admin
    openshift_user: admin

  pre_tasks:
  - name: 'Copy test files over to hosts'
    copy:
      src: 'files/'
      dest: '/tmp/create-openshift-resources/test/files'
  - name: 'Pre-create template-test project'
    command: >
      {{ openshift.common.admin_binary }} new-project template-test
  - name: 'Create the existingsecret'
    command: >
      {{ openshift.common.client_binary }} secrets new existingsecret /etc/redhat-release -n template-test

  roles:
    - openshift-defaults
    - create-openshift-resources

# cleanup
  post_tasks:
  - name: "Remove project {{ item.name }}"
    command: >
      {{ openshift.common.client_binary }} delete project {{ item.name  }}
    when: '"{{ item.name }}" != "ci" and cleanup is defined and cleanup'
    with_items: '{{ openshift_resources.projects }}'
